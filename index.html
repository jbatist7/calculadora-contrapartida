<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Contrapartida</title>
    <style>
        /* üì± Estilos Gerais e Mobile First */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background-color: #ffffff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #176B87;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.6em;
        }
        
        /* Estilos de Se√ß√£o para Organiza√ß√£o Visual */
        .secao {
            background-color: #f7f9fc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            border: 1px solid #e0e6ed;
        }
        
        .secao h2 {
            color: #007bff;
            font-size: 1.1em;
            margin-top: 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #e0e6ed;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }

        /* Estilo para inputs de dinheiro (fora do grupo de percentual) */
        input[type="number"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #b3cde0;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        
        /* Estilos para o texto da contrapartida m√≠nima (Corre√ß√£o de sobreposi√ß√£o) */
        .minimo-texto {
            font-size: 0.8em; 
            color: #555; 
            margin-top: 5px; 
            margin-bottom: 5px;
        }
        
        /* ---------------------------------------------------- */
        /* Estilos para o Sufixo de Percentual (%) Visual */
        /* ---------------------------------------------------- */
        
        .input-group {
            position: relative;
            margin-bottom: 15px; 
        }
        
        /* Estilo para os inputs DENTRO dos grupos (os de percentual) */
        .input-group input {
            width: 100%; 
            padding: 10px; 
            padding-right: 30px; 
            margin-bottom: 0;
            border: 1px solid #b3cde0; 
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }

        /* O sufixo '%' propriamente dito */
        .input-group::after {
            content: '%';
            position: absolute;
            top: 50%;
            right: 15px; 
            transform: translateY(-50%);
            font-size: 1em;
            color: #555; 
            pointer-events: none;
        }
        /* ---------------------------------------------------- */

        /* üìä Estilo para os campos de resultado (autom√°tico) */
        .resultado {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-weight: bold;
            color: #176B87;
            background-color: #e6f0ff;
            border: 1px solid #a8cbf4;
            font-size: 1.1em;
        }

        /* Destaque para o Valor Total Fixo (√Çncora) */
        #saidaTotal, #saidaTotalFinal {
            background-color: #ffe0b2;
            color: #a0522d;
            border: 2px solid #ffcc80;
            text-align: center;
            font-size: 1.2em;
        }
        
        /* ‚ö†Ô∏è Estilo para a mensagem de erro */
        #mensagemErro {
            color: #dc3545; 
            font-weight: bold;
            margin-top: 5px; 
            margin-bottom: 15px;
            display: none;
            background-color: #f8d7da;
            padding: 8px;
            border-radius: 4px;
        }
        
        /* üì± Estilo para o bot√£o de WhatsApp */
        #btnWhatsapp {
            background-color: #25D366;
            color: white;
            padding: 14px;
            border: none;
            border-radius: 25px;
            width: 100%;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s;
        }

        #btnWhatsapp:hover {
            background-color: #1DA851;
        }

        /* üñãÔ∏è Cr√©ditos do Autor (Discreto) */
        .creditos {
            text-align: center;
            margin-top: 25px;
            font-size: 0.75em; 
            color: #999;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Calculadora de Contrapartida</h1>
    
    <div class="secao">
        <h2>1. Defini√ß√£o do Valor Total (√Çncora)</h2>

        <label for="valorBaseSolicitado">Valor Base Solicitado (R$) (N√£o digite ponto):</label>
        <input type="number" id="valorBaseSolicitado" placeholder="Ex: 100,00" value="100.00" oninput="calcular(true)" step="0.01">

        <label for="percentualFinanciamentoRegra">Percentual M√°ximo de Financiamento (Regra do Edital, %):</label>
        <div class="input-group">
            <input type="number" id="percentualFinanciamentoRegra" placeholder="Ex: 90" value="90" oninput="calcular(true)">
        </div>
        
        <label>VALOR TOTAL DO PROJETO (√Çncora R$):</label>
        <div id="saidaTotal" class="resultado">Aguardando...</div>
    </div>
    
    <div class="secao">
        <h2>2. Contrapartida</h2>
        
        <label for="contrapartidaEscolha">Contrapartida m√≠nima exigida (<span id="percentualMinimoDisplay" style="color: #007bff;">0%</span>)</label>
        
        <p style="margin: 0; padding: 0; line-height: 0;"></p>
        
        <p class="minimo-texto">
            (Se for conveniente, aumente esse percentual para diminuir o valor solicitado)
        </p>
        
        <div class="input-group">
            <input type="number" id="contrapartidaEscolha" value="" oninput="calcular(false)" step="0.01">
        </div>
        
        <div id="mensagemErro">‚ö†Ô∏è O percentual digitado n√£o pode ser menor que o m√≠nimo exigido ou igual/superior a 100%.</div>
    </div>
    
    <div class="secao">
        <h2>3. Resultado Final da Proposta</h2>

        <label>Valor Solicitado (R$):</label>
        <div id="saidaNovoSolicitado" class="resultado">Aguardando...</div>
        
        <label>Valor da Contrapartida (R$):</label>
        <div id="saidaNovaContrapartida" class="resultado">Aguardando...</div>

        <label>Percentual de Financiamento (%):</label>
        <div id="saidaNovoPercentualFinanciamento" class="resultado">Aguardando...</div>
        
        <label>Total do Projeto (R$):</label>
        <div id="saidaTotalFinal" class="resultado">Aguardando...</div>
    </div>
    
    
    <button id="btnWhatsapp" onclick="enviarWhatsapp()" disabled>
        Enviar Resultados para WhatsApp
    </button>
    
    <div class="creditos">
        Calculadora criada por Jo√£o Batista - jbatist7@gmail.com
    </div>

</div>

<script>
    function formatarMoeda(valor) {
        if (isNaN(valor) || !isFinite(valor)) return 'Inv√°lido';
        return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    
    function formatarPercentual(valor) {
        if (isNaN(valor) || !isFinite(valor)) return 'Inv√°lido';
        return valor.toFixed(2) + '%';
    }

    /**
     * isInputBaseChanged: true se o Valor Base ou % Regra for alterado (recalcula a √¢ncora Vmax).
     */
    function calcular(isInputBaseChanged) {
        const valorBaseInput = document.getElementById('valorBaseSolicitado');
        const percentualRegraInput = document.getElementById('percentualFinanciamentoRegra');
        const contrapartidaEscolhaInput = document.getElementById('contrapartidaEscolha');
        const btnWhatsapp = document.getElementById('btnWhatsapp');
        const mensagemErro = document.getElementById('mensagemErro');

        let valorBaseSolicitado = parseFloat(valorBaseInput.value);
        let percentualRegra = parseFloat(percentualRegraInput.value);
        let contrapartidaEscolha = parseFloat(contrapartidaEscolhaInput.value);
        
        // --- 1. Valida√ß√£o da Base (R$ e % Regra) ---
        if (isNaN(valorBaseSolicitado) || valorBaseSolicitado <= 0 || isNaN(percentualRegra) || percentualRegra <= 0 || percentualRegra >= 100) {
            // Se a base est√° inv√°lida, limpa tudo e para.
            mensagemErro.style.display = 'none';
            btnWhatsapp.disabled = true;
            document.getElementById('saidaTotal').textContent = 'R$ 0,00';
            document.getElementById('saidaTotalFinal').textContent = 'R$ 0,00';
            document.getElementById('saidaNovoSolicitado').textContent = 'Aguardando...';
            document.getElementById('saidaNovaContrapartida').textContent = 'Aguardando...';
            document.getElementById('saidaNovoPercentualFinanciamento').textContent = 'Aguardando...';
            document.getElementById('percentualMinimoDisplay').textContent = '0%';
            return; 
        }

        // --- 2. Fixando a √Çncora (Valor Total do Projeto) ---
        const percentualRegraDecimal = percentualRegra / 100;
        const valorTotalFixo = valorBaseSolicitado / percentualRegraDecimal;
        document.getElementById('saidaTotal').textContent = formatarMoeda(valorTotalFixo);
        document.getElementById('saidaTotalFinal').textContent = formatarMoeda(valorTotalFixo); 


        // --- 3. C√°lculo do M√≠nimo e Reset de Base ---
        const percentualMinimo = 100 - percentualRegra;
        document.getElementById('percentualMinimoDisplay').textContent = formatarPercentual(percentualMinimo); 
        
        // Se a base (R$ ou % Regra) mudou, o campo de escolha DEVE ser resetado para o valor m√≠nimo.
        if (isInputBaseChanged) {
            contrapartidaEscolha = percentualMinimo;
            contrapartidaEscolhaInput.value = percentualMinimo.toFixed(2);
        }
        
        // --- 4. L√≥gica de Edi√ß√£o (Permitir Apagar sem Erro) ---

        // Se o t√©cnico est√° editando/apagando o campo (o valor √© NaN ou vazio)
        if (isNaN(contrapartidaEscolha) || contrapartidaEscolhaInput.value.trim() === '') {
            mensagemErro.style.display = 'none'; // Esconde o erro (√© edi√ß√£o, n√£o submiss√£o)
            
            // Exibe o status de espera
            document.getElementById('saidaNovoSolicitado').textContent = 'Aguardando digita√ß√£o...';
            document.getElementById('saidaNovaContrapartida').textContent = 'Aguardando digita√ß√£o...';
            document.getElementById('saidaNovoPercentualFinanciamento').textContent = 'Aguardando...';
            btnWhatsapp.disabled = true;
            return; // Interrompe o c√°lculo
        }

        // --- 5. Valida√ß√£o de Erro (Valor Num√©rico Inv√°lido) ---
        
        // Valida√ß√£o de erro: S√≥ checa se √© menor/maior que o m√≠nimo/m√°ximo, quando o valor √© NUM√âRICO.
        if (contrapartidaEscolha < percentualMinimo || contrapartidaEscolha >= 100) {
            mensagemErro.style.display = 'block'; // Mostra o erro de valor inv√°lido
            btnWhatsapp.disabled = true;
            document.getElementById('saidaNovoSolicitado').textContent = 'ERRO - Ajuste %';
            document.getElementById('saidaNovaContrapartida').textContent = 'ERRO - Ajuste %';
            document.getElementById('saidaNovoPercentualFinanciamento').textContent = 'ERRO';
            return;
        } else {
            mensagemErro.style.display = 'none'; // Esconde se o valor for v√°lido
        }

        // --- 6. C√°lculo dos Novos Valores (Continua se n√£o houve interrup√ß√£o) ---
        
        const percentualFinanciamentoEfetivo = 100 - contrapartidaEscolha;
        const percentualFinanciamentoEfetivoDecimal = percentualFinanciamentoEfetivo / 100;
        
        const novoValorSolicitado = valorTotalFixo * percentualFinanciamentoEfetivoDecimal;
        const novoValorContrapartida = valorTotalFixo * (contrapartidaEscolha / 100);
        
        // --- 7. Exibi√ß√£o ---
        document.getElementById('saidaNovoSolicitado').textContent = formatarMoeda(novoValorSolicitado);
        document.getElementById('saidaNovoPercentualFinanciamento').textContent = formatarPercentual(percentualFinanciamentoEfetivo);
        document.getElementById('saidaNovaContrapartida').textContent = formatarMoeda(novoValorContrapartida);
        
        btnWhatsapp.disabled = false;
    }
    
    function enviarWhatsapp() {
        const totalFinal = document.getElementById('saidaTotalFinal').textContent;
        const novoSolicitado = document.getElementById('saidaNovoSolicitado').textContent;
        const novaContrapartida = document.getElementById('saidaNovaContrapartida').textContent;
        const percentualFinanciamentoEfetivo = document.getElementById('saidaNovoPercentualFinanciamento').textContent;
        
        const percentualRegra = document.getElementById('percentualFinanciamentoRegra').value;
        const contrapartidaEscolha = document.getElementById('contrapartidaEscolha').value;
        const percentualMinimo = 100 - parseFloat(percentualRegra);

        // Monta a mensagem - APENAS RESULTADOS FINAIS
        const mensagem = 
            `*PROPOSTA FINAL - Projeto de Valor Fixo*%0A%0A` +
            `*Regra M√≠nima do Edital:* ${formatarPercentual(percentualMinimo)} Contrapartida%0A` +
            `*Contrapartida Escolhida na Proposta:* ${formatarPercentual(parseFloat(contrapartidaEscolha))}%0A` +
            `----------------------------------%0A` +
            `*Valor Total do Projeto (Fixo):* ${totalFinal}%0A` +
            `*Novo Valor Solicitado:* ${novoSolicitado}%0A` +
            `*Novo Valor da Contrapartida:* ${novaContrapartida}%0A` +
            `*Percentual de Financiamento Efetivo:* ${percentualFinanciamentoEfetivo}`;

        const linkWhatsapp = `https://wa.me/?text=${mensagem}`;
        window.open(linkWhatsapp, '_blank');
    }

    // Executa o c√°lculo inicial
    window.onload = function() {
        calcular(true); 
    };
</script>

</body>
</html>
